#  /*
#  * @description æ¸…ç†å·¥ä½œåŒºä¸‹çš„ node modules
#  * @create 2023-02-13 20:16:16
#  * @update 2023-02-13 20:16:16
#  * @version 1.0
#  */
import os
import shutil
import sys
from pathlib import Path

if __name__ == '__main__':
    print('ğŸš— å¼€å§‹æ¸…ç†ç¹é‡çš„ node_modules å•¦ï¼')
    work_space_path = '/Users/quentin/Work-Space/Personal/GitHub/Open-Source'
    if not os.path.exists(work_space_path):
        print('ğŸ’ æ‚¨æ‰€è®¾ç½®çš„ Work Space è·¯å¾„ï¼š', work_space_path)
        print('â›”ï¸ è¯¥ Work Space è·¯å¾„ä¸å­˜åœ¨ï¼è¯·æ›´æ”¹ï¼')
        sys.exit(0)

    def get_assigned_path_child_dir_list(assigned_path):
        for root, dirs, files in os.walk(assigned_path):
            print('ğŸ’ æ‚¨æ‰€æŒ‡å®šæ¸…ç†çš„ WorkSpace è·¯å¾„:', assigned_path)
            print('ğŸš¦ å½“å‰è·¯å¾„ä¸‹å­çº§è·¯å¾„ä¸ªæ•°ï¼š', len(assigned_path))
            return dirs

    dir_list = get_assigned_path_child_dir_list(work_space_path)

    node_modules_paths = []
    print("ğŸ” æ­£åœ¨ç­›é€‰åŒ…å« node_modules æ–‡ä»¶å¤¹çš„è·¯å¾„")
    for dir_item in dir_list:
        dir_child_node_modules = Path(work_space_path + dir_item + '/node_modules/')
        if dir_child_node_modules.is_dir():
            node_modules_paths.append(dir_child_node_modules)
    print('ğŸ‘€ å·²æ‰¾åˆ°åŒ…å« node_modules æ–‡ä»¶å¤¹çš„è·¯å¾„ä¸ªæ•°ï¼š', len(node_modules_paths), )

    def get_file_size(file_path, size=0):
        for root, dirs, files in os.walk(file_path):
            for f in files:
                size += os.path.getsize(os.path.join(root, f))
        return size

    def convert_file_size(size):
        kb = 1024
        mb = kb * 1024
        gb = mb * 1024
        tb = gb * 1024

        if size >= tb:
            return "%.1f TB" % float(size / tb)
        if size >= gb:
            return "%.1f GB" % float(size / gb)
        if size >= mb:
            return "%.1f MB" % float(size / mb)
        if size >= kb:
            return "%.1f KB" % float(size / kb)


    node_modules_size = 0
    if len(node_modules_paths) > 0:

        for node_modules_path in node_modules_paths:
            try:
                node_modules_size += get_file_size(Path(node_modules_path))
                shutil.rmtree(Path(node_modules_path))
            except IOError:
                print('åˆ é™¤å¤±è´¥ï¼ï¼ï¼ï¼')
            else:
                print('ğŸ‰ åˆ é™¤æˆåŠŸï¼ è·¯å¾„ï¼š', node_modules_path)
        print("âœ… æ¸…ç†å®Œæˆï¼")
        print('ğŸš® æ¸…ç†æ‰åƒåœ¾ï¼š ', convert_file_size(node_modules_size))
    else:
        print('ğŸ™… å½“å‰ WorkSpace æ— éœ€æ¸…ç†ï¼å› ä¸ºè¯¥ WorkSpace å­çº§è·¯å¾„ä¸‹æ²¡æœ‰åŒ…å« node_modules æ–‡ä»¶å¤¹ã€‚')
